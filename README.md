# Node-Based å›¾åƒç¼–è¾‘å™¨

ä¸€ä¸ªåŸºäº Node çš„éç ´åæ€§å›¾åƒç¼–è¾‘å™¨ï¼Œä½¿ç”¨ React + TypeScript + WebGL æ„å»ºã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¼€å‘æ¨¡å¼
```bash
npm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
npm run build
npm run preview
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
node-image-editor/
â”œâ”€â”€ src/                        # æºä»£ç 
â”‚   â”œâ”€â”€ components/             # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ canvas/            # ç”»å¸ƒç›¸å…³ï¼ˆèŠ‚ç‚¹ç¼–è¾‘å™¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ node-library/      # èŠ‚ç‚¹åº“é¢æ¿
â”‚   â”‚   â”œâ”€â”€ properties/        # å±æ€§é¢æ¿
â”‚   â”‚   â”œâ”€â”€ preview/           # é¢„è§ˆé¢æ¿
â”‚   â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒå¼•æ“ï¼ˆæ—  UI ä¾èµ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ engine/            # æ‰§è¡Œå¼•æ“
â”‚   â”‚   â”œâ”€â”€ gpu/               # GPU æ¸²æŸ“ç®¡çº¿ï¼ˆWebGLï¼‰
â”‚   â”‚   â”œâ”€â”€ nodes/             # èŠ‚ç‚¹å®šä¹‰
â”‚   â”‚   â””â”€â”€ codec/             # å›¾åƒç¼–è§£ç 
â”‚   â”œâ”€â”€ store/                  # Redux çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ hooks/                  # è‡ªå®šä¹‰ React Hooks
â”‚   â”œâ”€â”€ shaders/                # GLSL Shader æ–‡ä»¶
â”‚   â”œâ”€â”€ i18n/                   # å›½é™…åŒ–
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ tests/                      # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ components/            # ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ engine/                # å¼•æ“æµ‹è¯•
â”‚   â”œâ”€â”€ gpu/                   # GPU æµ‹è¯•
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ e2e/                        # E2E ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ comprehensive.spec.ts  # ç»¼åˆæµ‹è¯•
â”‚   â”œâ”€â”€ edge-replacement.spec.ts  # è¾¹æ›¿æ¢æµ‹è¯•
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ design/                # è®¾è®¡æ–‡æ¡£
â”‚   â”‚   â””â”€â”€ node-base.md       # äº§å“è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ test-reports/          # æµ‹è¯•æŠ¥å‘Š
â”‚       â”œâ”€â”€ TEST_CASES.md      # æµ‹è¯•ç”¨ä¾‹
â”‚       â”œâ”€â”€ EDGE_SELECTION_TEST.md  # è¾¹é€‰ä¸­æµ‹è¯•
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ scripts/                    # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ debug/                 # è°ƒè¯•è„šæœ¬
â”‚   â”œâ”€â”€ test-helpers/          # æµ‹è¯•è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ start-prod.sh          # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
â”‚
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ fonts/                 # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ templates/             # é¡¹ç›®æ¨¡æ¿
â”‚
â”œâ”€â”€ electron/                   # Electron æ¡Œé¢ç«¯ï¼ˆè®¡åˆ’ä¸­ï¼‰
â”‚
â””â”€â”€ config files                # é…ç½®æ–‡ä»¶
    â”œâ”€â”€ package.json           # é¡¹ç›®ä¾èµ–
    â”œâ”€â”€ tsconfig.json          # TypeScript é…ç½®
    â”œâ”€â”€ vite.config.ts         # Vite æ„å»ºé…ç½®
    â”œâ”€â”€ playwright.config.ts   # Playwright E2E é…ç½®
    â”œâ”€â”€ vitest.config.ts       # Vitest å•å…ƒæµ‹è¯•é…ç½®
    â””â”€â”€ ...
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
npm run test              # äº¤äº’å¼æµ‹è¯•
npm run test:run          # è¿è¡Œä¸€æ¬¡
npm run test:coverage     # æµ‹è¯•è¦†ç›–ç‡
```

### E2E æµ‹è¯•
```bash
npm run e2e               # è¿è¡Œ E2E æµ‹è¯•
npm run e2e:ui            # UI æ¨¡å¼
```

### ä»£ç è´¨é‡
```bash
npm run lint              # ESLint æ£€æŸ¥
npx tsc --noEmit          # TypeScript ç±»å‹æ£€æŸ¥
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¶æ„ï¼ˆ5 å±‚ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Layer (React Components)      â”‚  ç”¨æˆ·ç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   State Layer (Redux Store)        â”‚  çŠ¶æ€ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Node System (87 ç§èŠ‚ç‚¹ç±»å‹)      â”‚  èŠ‚ç‚¹ç³»ç»Ÿ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Execution Engine                 â”‚  æ‰§è¡Œå¼•æ“
â”‚   - DirtyTracker (è„èŠ‚ç‚¹è¿½è¸ª)     â”‚
â”‚   - TopologySorter (æ‹“æ‰‘æ’åº)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   GPU Pipeline (WebGL 2.0)         â”‚  GPU æ¸²æŸ“
â”‚   - ShaderManager                  â”‚
â”‚   - TextureManager                 â”‚
â”‚   - FramebufferManager             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ â†’ Redux Action â†’ GraphSlice æ›´æ–°
                â†“
        ExecutionEngine ç›‘å¬
                â†“
        DirtyTracker æ ‡è®°è„èŠ‚ç‚¹
                â†“
        TopologySorter æ‹“æ‰‘æ’åº
                â†“
        é€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ (GPU æ¸²æŸ“)
                â†“
        æ›´æ–°é¢„è§ˆé¢æ¿
```

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### èŠ‚ç‚¹ç³»ç»Ÿ
- **è¾“å…¥èŠ‚ç‚¹**ï¼šå›¾ç‰‡å¯¼å…¥ã€çº¯è‰²å¡«å……
- **è°ƒæ•´èŠ‚ç‚¹**ï¼šäº®åº¦/å¯¹æ¯”åº¦ã€è‰²é˜¶ã€HSLã€è‰²å½©å¹³è¡¡
- **æ»¤é•œèŠ‚ç‚¹**ï¼šé«˜æ–¯æ¨¡ç³Šã€é”åŒ–ç­‰
- **å˜æ¢èŠ‚ç‚¹**ï¼šç¼©æ”¾ã€è£å‰ªã€æ—‹è½¬ã€ç¿»è½¬
- **åˆæˆèŠ‚ç‚¹**ï¼šæ··åˆæ¨¡å¼
- **è¾“å‡ºèŠ‚ç‚¹**ï¼šé¢„è§ˆè¾“å‡ºã€å›¾ç‰‡å¯¼å‡º

### è¿çº¿ç³»ç»Ÿ
- âœ… è¾“å…¥ç«¯å£è‡ªåŠ¨æ›¿æ¢ï¼ˆå•è¾“å…¥é™åˆ¶ï¼‰
- âœ… è¿çº¿é€‰ä¸­ï¼ˆç‚¹å‡»å˜çº¢è‰²ï¼‰
- âœ… åˆ é™¤æŒ‰é’®ï¼ˆé€‰ä¸­åæ˜¾ç¤ºï¼‰
- âœ… é”®ç›˜åˆ é™¤ï¼ˆDelete/Backspaceï¼‰

### æ‰§è¡Œå¼•æ“
- âœ… è„èŠ‚ç‚¹è¿½è¸ªï¼ˆå¢é‡è®¡ç®—ï¼‰
- âœ… æ‹“æ‰‘æ’åºï¼ˆä¾èµ–é¡ºåºæ‰§è¡Œï¼‰
- âœ… é˜²æŠ–ä¼˜åŒ–ï¼ˆ100msï¼‰
- âœ… ç¯è·¯æ£€æµ‹

### GPU æ¸²æŸ“
- âœ… WebGL 2.0 åŸç”Ÿå®ç°
- âœ… Shader ç®¡ç†
- âœ… çº¹ç†æ± ä¼˜åŒ–
- âœ… ç¦»å±æ¸²æŸ“ï¼ˆFramebufferï¼‰

## ğŸŒ å›½é™…åŒ–

æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ï¼Œä½¿ç”¨ i18next å®ç°ã€‚

```typescript
import { useTranslation } from 'react-i18next';
const { t } = useTranslation();
t('node.input.image_import'); // å›¾ç‰‡å¯¼å…¥
```

## ğŸ“Š æŠ€æœ¯æ ˆ

| ç±»å‹ | æŠ€æœ¯ |
|------|------|
| **è¯­è¨€** | TypeScript 5.3.3 |
| **UI æ¡†æ¶** | React 18.2.0 |
| **èŠ‚ç‚¹ç¼–è¾‘å™¨** | React Flow 11.10.1 |
| **çŠ¶æ€ç®¡ç†** | Redux Toolkit 2.0.1 |
| **æ ·å¼** | TailwindCSS 3.4.0 |
| **æ„å»ºå·¥å…·** | Vite 5.0.10 |
| **GPU æ¸²æŸ“** | WebGL 2.0 |
| **å•å…ƒæµ‹è¯•** | Vitest 1.1.0 |
| **E2E æµ‹è¯•** | Playwright 1.40.1 |
| **å›½é™…åŒ–** | i18next 23.7.11 |

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°èŠ‚ç‚¹

1. åœ¨ `src/core/nodes/` ç›¸åº”åˆ†ç±»ä¸‹åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶
2. å®šä¹‰èŠ‚ç‚¹ç±»å‹ã€è¾“å…¥è¾“å‡ºã€å‚æ•°
3. å®ç° `execute` å‡½æ•°
4. åœ¨ `src/core/nodes/index.ts` æ³¨å†ŒèŠ‚ç‚¹
5. æ·»åŠ å›½é™…åŒ–ç¿»è¯‘

ç¤ºä¾‹ï¼š
```typescript
export const MyNode: NodeTypeDefinition = {
  type: 'my_node',
  category: 'filter',
  label: 'node.filter.my_node',
  inputs: [{ name: 'image', type: 'image' }],
  outputs: [{ name: 'image', type: 'image' }],
  params: [
    { key: 'intensity', type: 'slider', default: 1.0, min: 0, max: 2 }
  ],
  execute: async (context) => {
    // å®ç°é€»è¾‘
  }
};
```

### æ·»åŠ æ–° Shader

1. åœ¨ `src/shaders/` ç›¸åº”åˆ†ç±»ä¸‹åˆ›å»º `.frag` æ–‡ä»¶
2. ç¼–å†™ GLSL ä»£ç 
3. åœ¨èŠ‚ç‚¹çš„ `execute` ä¸­ä½¿ç”¨ï¼š

```typescript
const program = context.gpu.shaderManager.getProgram(
  'fullscreen',
  'my_shader'
);
```

### è¿è¡Œè°ƒè¯•è„šæœ¬

```bash
# è°ƒè¯•èŠ‚ç‚¹è¿æ¥
node scripts/debug/debug-connect.cjs

# è°ƒè¯•é¢œè‰²æ¸²æŸ“
node scripts/debug/debug-color.cjs

# åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹
node scripts/test-helpers/list-nodes.cjs
```

## ğŸ“ æ–‡æ¡£

- [äº§å“è®¾è®¡æ–‡æ¡£](docs/design/node-base.md) - å®Œæ•´çš„æ¶æ„å’Œè®¾è®¡è¯´æ˜
- [æµ‹è¯•ç”¨ä¾‹](docs/test-reports/TEST_CASES.md) - æ‰€æœ‰åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹
- [è¾¹é€‰ä¸­æµ‹è¯•](docs/test-reports/EDGE_SELECTION_TEST.md) - è¿çº¿åŠŸèƒ½æµ‹è¯•

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“œ Git æäº¤è§„èŒƒ

ä½¿ç”¨ Conventional Commitsï¼š

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

ç¤ºä¾‹ï¼š
```bash
git commit -m "feat: æ·»åŠ é«˜æ–¯æ¨¡ç³ŠèŠ‚ç‚¹"
git commit -m "fix: ä¿®å¤è¾¹é€‰ä¸­çŠ¶æ€åŒæ­¥é—®é¢˜"
```

## ğŸ“„ è®¸å¯è¯

[MIT License](LICENSE)

## ğŸ™ è‡´è°¢

- [React Flow](https://reactflow.dev/) - èŠ‚ç‚¹ç¼–è¾‘å™¨åŸºç¡€
- [Redux Toolkit](https://redux-toolkit.js.org/) - çŠ¶æ€ç®¡ç†
- [Vite](https://vitejs.dev/) - æ„å»ºå·¥å…·
- [Playwright](https://playwright.dev/) - E2E æµ‹è¯•

---

**é¡¹ç›®çŠ¶æ€**ï¼šğŸš§ å¼€å‘ä¸­

**ç‰ˆæœ¬**ï¼š0.0.1

**æœ€åæ›´æ–°**ï¼š2026-02-26
