# Node Image Editor 测试用例

本文档包含 Node Image Editor 的完整测试用例，覆盖所有节点类型和功能。

---

## 测试节点概览

| 分类 | 节点数量 | 节点列表 |
|------|----------|----------|
| 输入 | 2 | 图片导入、纯色填充 |
| 调整 | 4 | 亮度/对比度、色阶、HSL调整、色彩平衡 |
| 滤镜 | 1 | 高斯模糊 |
| 变换 | 4 | 缩放、裁剪、旋转、翻转 |
| 合成 | 1 | 混合图像 |
| 输出 | 2 | 图片导出、预览输出 |
| **总计** | **14** | |

---

## 一、输入节点测试

### 1.1 纯色填充节点 (solid_color)

#### 测试用例：纯色填充颜色验证

**测试目标**：验证纯色填充节点输出的颜色与设置的颜色一致

**输入参数**：
- 颜色：15种测试颜色
- 宽度：1920
- 高度：1080

**测试颜色列表**：

| ID | 颜色名称 | RGB 输入 | 期望 RGB | 判定条件 |
|----|----------|----------|----------|----------|
| PREVIEW-01 | 纯红色 | (255, 0, 0) | (255, 0, 0) | R>245, G<10, B<10 |
| PREVIEW-02 | 纯绿色 | (0, 255, 0) | (0, 255, 0) | R<10, G>245, B<10 |
| PREVIEW-03 | 纯蓝色 | (0, 0, 255) | (0, 0, 255) | R<10, G<10, B>245 |
| PREVIEW-04 | 纯白色 | (255, 255, 255) | (255, 255, 255) | R>245, G>245, B>245 |
| PREVIEW-05 | 纯黑色 | (0, 0, 0) | (0, 0, 0) | R<10, G<10, B<10 |
| PREVIEW-06 | 黄色 | (255, 255, 0) | (255, 255, 0) | R>245, G>245, B<10 |
| PREVIEW-07 | 青色 | (0, 255, 255) | (0, 255, 255) | R<10, G>245, B>245 |
| PREVIEW-08 | 洋红色 | (255, 0, 255) | (255, 0, 255) | R>245, G<10, B>245 |
| PREVIEW-09 | 橙色 | (255, 128, 0) | (255, 128, 0) | R>245, G>118, B<10 |
| PREVIEW-10 | 粉色 | (255, 192, 203) | (255, 192, 203) | R>245, G>182, B>193 |
| PREVIEW-11 | 紫色 | (128, 0, 128) | (128, 0, 128) | R>118, G<10, B>118 |
| PREVIEW-12 | 棕色 | (139, 69, 19) | (139, 69, 19) | R>129, G>59, B<29 |
| PREVIEW-13 | 灰色 | (128, 128, 128) | (128, 128, 128) | R>118, G>118, B>118 |
| PREVIEW-14 | 浅蓝 | (173, 216, 230) | (173, 216, 230) | R>163, G>206, B>220 |
| PREVIEW-15 | Lime | (0, 255, 0) | (0, 255, 0) | R<10, G>245, B<10 |

**测试步骤**：
1. 启动服务：`npm run preview -- --port 4173`
2. 打开浏览器访问：`http://localhost:4173`
3. 添加"纯色填充"节点
4. 添加"预览输出"节点
5. 连接两个节点
6. 选择纯色填充节点，打开属性面板
7. 设置颜色值
8. 从预览 Canvas 中心采样像素
9. 验证像素值是否符合预期

**判定标准**：每个通道的误差小于 10

---

#### 测试用例：纯色填充尺寸验证

**测试目标**：验证输出图像尺寸与设置一致

| ID | 测试名称 | 宽度输入 | 高度输入 | 期望尺寸 |
|----|----------|----------|----------|----------|
| SIZE-01 | 默认尺寸 | 1920 | 1080 | 1920×1080 |
| SIZE-02 | 4K分辨率 | 3840 | 2160 | 3840×2160 |
| SIZE-03 | 小尺寸 | 320 | 240 | 320×240 |
| SIZE-04 | 正方形 | 1000 | 1000 | 1000×1000 |

---

### 1.2 图片导入节点 (image_import)

#### 测试用例：图片导入功能

| ID | 测试名称 | 测试内容 | 期望结果 |
|----|----------|----------|----------|
| IMP-01 | 导入 PNG | 导入 PNG 图片 | 图片正确加载 |
| IMP-02 | 导入 JPG | 导入 JPG 图片 | 图片正确加载 |
| IMP-03 | 导入 WebP | 导入 WebP 图片 | 图片正确加载 |
| IMP-04 | 大图导入 | 导入 4K 图片 | 正确显示尺寸 |
| IMP-05 | 小图导入 | 导入图标图片 | 正确显示尺寸 |

---

## 二、调整节点测试

### 2.1 亮度/对比度节点 (brightness_contrast)

**参数**：
- brightness: 滑块 [-1, 1], 默认 0
- contrast: 滑块 [0, 3], 默认 1

#### 测试用例

| ID | 测试名称 | brightness | contrast | 期望效果 |
|----|----------|------------|----------|----------|
| BC-01 | 默认值 | 0 | 1 | 图像不变 |
| BC-02 | 亮度+ | 0.5 | 1 | 图像变亮 |
| BC-03 | 亮度- | -0.5 | 1 | 图像变暗 |
| BC-04 | 对比度+ | 0 | 2 | 对比度增加 |
| BC-05 | 对比度- | 0 | 0.5 | 对比度降低 |
| BC-06 | 亮度+对比度+ | 0.3 | 1.5 | 两者同时增强 |

---

### 2.2 色阶节点 (levels)

**参数**：
- blackPoint: 滑块 [0, 1], 默认 0
- whitePoint: 滑块 [0, 1], 默认 1
- gamma: 滑块 [0.1, 3], 默认 1

#### 测试用例

| ID | 测试名称 | blackPoint | whitePoint | gamma | 期望效果 |
|----|----------|------------|------------|-------|----------|
| LEVEL-01 | 默认值 | 0 | 1 | 1 | 图像不变 |
| LEVEL-02 | 压缩暗部 | 0.2 | 1 | 1 | 暗部细节减少 |
| LEVEL-03 | 压缩亮部 | 0 | 0.8 | 1 | 亮部细节减少 |
| LEVEL-04 | 伽马校正 | 0 | 1 | 2 | 整体变亮 |

---

### 2.3 HSL 调整节点 (hsl)

**参数**：
- hue: 滑块 [-180, 180], 默认 0
- saturation: 滑块 [-1, 1], 默认 0
- lightness: 滑块 [-1, 1], 默认 0

#### 测试用例

| ID | 测试名称 | hue | saturation | lightness | 期望效果 |
|----|----------|-----|------------|-----------|----------|
| HSL-01 | 默认值 | 0 | 0 | 0 | 图像不变 |
| HSL-02 | 色相旋转90 | 90 | 0 | 0 | 色相旋转90度 |
| HSL-03 | 饱和度+ | 0 | 0.5 | 0 | 饱和度增加 |
| HSL-04 | 饱和度- | 0 | -0.5 | 0 | 饱和度降低 |
| HSL-05 | 亮度+ | 0 | 0 | 0.3 | 整体变亮 |
| HSL-06 | 亮度- | 0 | 0 | -0.3 | 整体变暗 |

---

### 2.4 色彩平衡节点 (color_balance)

**参数**：
- shadowsR/G/B: 滑块 [-1, 1], 默认 0
- midtonesR/G/B: 滑块 [-1, 1], 默认 0
- highlightsR/G/B: 滑块 [-1, 1], 默认 0

#### 测试用例

| ID | 测试名称 | 参数 | 期望效果 |
|----|----------|------|----------|
| CB-01 | 默认值 | 全部 0 | 图像不变 |
| CB-02 | 阴影偏红 | shadowsR=0.3 | 阴影偏红 |
| CB-03 | 中间调偏绿 | midtonesG=0.3 | 中间调偏绿 |
| CB-04 | 高光偏蓝 | highlightsB=0.3 | 高光偏蓝 |

---

## 三、滤镜节点测试

### 3.1 高斯模糊节点 (gaussian_blur)

**参数**：
- radius: 滑块 [0, 50], 默认 5

#### 测试用例

| ID | 测试名称 | radius | 期望效果 |
|----|----------|--------|----------|
| BLUR-01 | 无模糊 | 0 | 图像不变 |
| BLUR-02 | 轻度模糊 | 3 | 轻微模糊 |
| BLUR-03 | 中度模糊 | 10 | 明显模糊 |
| BLUR-04 | 重度模糊 | 30 | 严重模糊 |

**验证方法**：采样模糊后图像的中心像素，应接近周围像素的平均值

---

## 四、变换节点测试

### 4.1 缩放节点 (resize)

**参数**：
- width: 数字 [1, 8192], 默认 1920
- height: 数字 [1, 8192], 默认 1080
- fit: 选择 [stretch, fit, fill, crop], 默认 stretch

#### 测试用例

| ID | 测试名称 | 输入尺寸 | 目标尺寸 | fit模式 | 期望输出 |
|----|----------|----------|----------|---------|----------|
| RESIZE-01 | 等比缩放 | 1920×1080 | 960×540 | stretch | 960×540 |
| RESIZE-02 | 拉伸 | 1920×1080 | 800×600 | stretch | 800×600 |
| RESIZE-03 | 适应 | 1920×1080 | 800×600 | fit | 800×450 |
| RESIZE-04 | 填充 | 1920×1080 | 800×600 | fill | 800×600 |
| RESIZE-05 | 裁剪 | 1920×1080 | 800×600 | crop | 800×600 |

---

### 4.2 裁剪节点 (crop)

**参数**：
- x: 数字, 默认 0
- y: 数字, 默认 0
- width: 数字, 默认 1920
- height: 数字, 默认 1080

#### 测试用例

| ID | 测试名称 | 输入尺寸 | crop参数 | 期望输出 |
|----|----------|----------|---------|----------|
| CROP-01 | 中心裁剪 | 1920×1080 | x=320,y=0,w=1280,h=720 | 1280×720 |
| CROP-02 | 顶部裁剪 | 1920×1080 | x=0,y=0,w=1920,h=540 | 1920×540 |
| CROP-03 | 角落裁剪 | 1920×1080 | x=100,y=100,w=500,h=500 | 500×500 |

---

### 4.3 旋转节点 (rotate)

**参数**：
- angle: 数字 [-360, 360], 默认 0
- expand: 布尔值, 默认 false

#### 测试用例

| ID | 测试名称 | angle | expand | 期望效果 |
|----|----------|-------|--------|----------|
| ROT-01 | 无旋转 | 0 | false | 图像不变 |
| ROT-02 | 旋转90 | 90 | false | 顺时针90度 |
| ROT-03 | 旋转180 | 180 | false | 旋转180度 |
| ROT-04 | 旋转-90 | -90 | false | 逆时针90度 |
| ROT-05 | 扩展旋转90 | 90 | true | 90度+扩展画布 |

---

### 4.4 翻转节点 (flip)

**参数**：
- horizontal: 布尔值, 默认 false
- vertical: 布尔值, 默认 false

#### 测试用例

| ID | 测试名称 | horizontal | vertical | 期望效果 |
|----|----------|------------|----------|----------|
| FLIP-01 | 无翻转 | false | false | 图像不变 |
| FLIP-02 | 水平翻转 | true | false | 左右镜像 |
| FLIP-03 | 垂直翻转 | false | true | 上下镜像 |
| FLIP-04 | 水平+垂直 | true | true | 180度旋转 |

---

## 五、合成节点测试

### 5.1 混合图像节点 (blend)

**参数**：
- mode: 选择 [normal, multiply, screen, overlay, darken, lighten, color_dodge, color_burn, soft_light, hard_light, difference, exclusion], 默认 normal
- opacity: 滑块 [0, 1], 默认 1

#### 测试用例

| ID | 测试名称 | mode | opacity | 期望效果 |
|----|----------|------|---------|----------|
| BLEND-01 | 正常混合 | normal | 1 | 上层覆盖下层 |
| BLEND-02 | 正片叠底 | multiply | 1 | 变暗效果 |
| BLEND-03 | 滤色 | screen | 1 | 变亮效果 |
| BLEND-04 | 叠加 | overlay | 1 | 混合效果 |
| BLEND-05 | 变暗 | darken | 1 | 取较暗像素 |
| BLEND-06 | 变亮 | lighten | 1 | 取较亮像素 |
| BLEND-07 | 50%透明 | normal | 0.5 | 半透明混合 |

---

## 六、输出节点测试

### 6.1 预览输出节点 (preview_output)

#### 测试用例

| ID | 测试名称 | 期望结果 |
|----|----------|----------|
| PREV-01 | 节点存在 | 预览面板显示 |
| PREV-02 | 图像更新 | 修改输入后预览更新 |
| PREV-03 | 最小化 | 可最小化预览面板 |
| PREV-04 | 分辨率显示 | 显示正确分辨率 |

---

### 6.2 图片导出节点 (image_export)

#### 测试用例

| ID | 测试名称 | 期望结果 |
|----|----------|----------|
| EXP-01 | 导出 PNG | 可导出 PNG 文件 |
| EXP-02 | 导出 JPG | 可导出 JPG 文件 |
| EXP-03 | 导出 WebP | 可导出 WebP 文件 |
| EXP-04 | 分辨率正确 | 导出图像尺寸正确 |

---

## 七、集成测试

### 7.1 节点连接测试

| ID | 测试名称 | 节点链 | 期望结果 |
|----|----------|--------|----------|
| CHAIN-01 | 基础流程 | 纯色→预览 | 显示纯色 |
| CHAIN-02 | 调整流程 | 纯色→亮度→预览 | 显示调整后颜色 |
| CHAIN-03 | 滤镜流程 | 纯色→模糊→预览 | 显示模糊效果 |
| CHAIN-04 | 变换流程 | 纯色→缩放→预览 | 显示缩放后图像 |
| CHAIN-05 | 多节点 | 纯色→亮度→模糊→预览 | 显示完整处理结果 |

### 7.2 复杂流程测试

| ID | 测试名称 | 流程描述 |
|----|----------|----------|
| COMPLEX-01 | 图像调色 | 图片导入→色阶→HSL→亮度对比度→预览 |
| COMPLEX-02 | 艺术效果 | 纯色→高斯模糊→色彩平衡→混合→导出 |
| COMPLEX-03 | 拼图 | 图片1→缩放 + 图片2→缩放 → 混合 → 导出 |

---

## 八、测试执行指南

### 像素采样方法

```javascript
// 采样预览 Canvas 中心像素
async function sampleCenterPixel(page) {
  const canvas = page.locator('canvas').first();
  return await canvas.evaluate(c => {
    const ctx = c.getContext('2d');
    const data = ctx.getImageData(c.width / 2, c.height / 2, 1, 1).data;
    return { r: data[0], g: data[1], b: data[2], a: data[3] };
  });
}

// 颜色判定（误差 < 10）
const isColor = (pixel, r, g, b) => {
  return Math.abs(pixel.r - r) < 10 &&
         Math.abs(pixel.g - g) < 10 &&
         Math.abs(pixel.b - b) < 10;
};
```

### 测试输出格式

```
[PREVIEW-01] 纯红色
输入: (255, 0, 0)
采样: [253, 5, 3]
判定: R>245 ✓, G<10 ✓, B<10 ✓
结果: PASS ✅
```

### 自动化测试脚本

运行颜色测试：
```bash
cd ~/github/node
node test-15-colors.cjs
```

---

## 九、已知问题

- 预览面板最小化后恢复有时导致像素采样失败
- 某些颜色设置后需要等待渲染完成才能正确采样

---

_本文档最后更新：2026-02-22_
